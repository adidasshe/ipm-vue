(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6279f4a8"],{c067:function(t,i,a){"use strict";a.r(i);var e=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"dialog"},[a("div",{attrs:{id:"map"}},[a("el-dialog",{staticStyle:{"margin-top":"27%","margin-left":"8%",width:"100%"},attrs:{visible:t.LogVisible,"close-on-click-modal":!1,"show-close":!1,modal:!1,width:"0"},on:{"update:visible":function(i){t.LogVisible=i}}},[t.LodingVisible?a("div",{staticClass:"main"},[a("div",{staticClass:"loding-text"},[a("div",{staticClass:"loading"},[t._v("\n            任务初始化中\n            "),a("span"),t._v(" "),a("span"),t._v(" "),a("span"),t._v(" "),a("span"),t._v(" "),a("span")])])]):t._e(),t._v(" "),a("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],ref:"scroll",staticClass:"infinite-list",staticStyle:{overflow:"auto"}},t._l(t.count,(function(i){return a("li",{ref:"li",refInFor:!0,staticClass:"infinite-list-item"},[t._v(t._s(i))])})),0)]),t._v(" "),a("el-dialog",{attrs:{title:"任务结果",visible:t.dialogFormVisible},on:{"update:visible":function(i){t.dialogFormVisible=i}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"500px","margin-left":"50px"},attrs:{model:t.temp,"label-position":"left","label-width":"130px",size:"mini"}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{model:{value:t.temp.task_name,callback:function(i){t.$set(t.temp,"task_name",i)},expression:"temp.task_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"车辆总数"}},[a("el-input",{model:{value:t.temp.total_car,callback:function(i){t.$set(t.temp,"total_car",i)},expression:"temp.total_car"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"总共耗时"}},[a("el-input",{model:{value:t.temp.total_time,callback:function(i){t.$set(t.temp,"total_time",i)},expression:"temp.total_time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"平均速度:(KM/H)"}},[a("el-input",{model:{value:t.temp.avg_speed,callback:function(i){t.$set(t.temp,"avg_speed",i)},expression:"temp.avg_speed"}})],1),t._v(" "),t._l(t.temp.dest,(function(i,e){return a("el-form-item",{attrs:{label:"疏散点: "+(e+1),prop:"dest"}},[a("el-input",{model:{value:i.destination,callback:function(a){t.$set(i,"destination",a)},expression:"dest.destination"}}),t._v(" "),a("el-form-item",{attrs:{label:"应到车辆:"}},[a("el-input",{model:{value:i.should_arrived,callback:function(a){t.$set(i,"should_arrived",a)},expression:"dest.should_arrived"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"实到车辆:"}},[a("el-input",{model:{value:i.arrived,callback:function(a){t.$set(i,"arrived",a)},expression:"dest.arrived"}})],1)],1)}))],2),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(i){t.dialogFormVisible=!1}}},[t._v("确定")])],1)],1)],1)])},n=[],s=(a("6b54"),a("db72")),o=a("b199"),l=a("2f62"),r=a("e11eb"),c=a.n(r),d=(a("6cc5"),a("debe"),a("b100"),a("6397"),a("9c4f")),u=a.n(d),p=a("e2b9"),h=a.n(p),m=(a("d8ad"),{data:function(){return{progress:1,log:{},count:["任务日志"],data:{},temp:{},taskLogStatus:0,dialogFormVisible:!1,LodingVisible:!1,LogVisible:!1,initStatus:0,result:"",speed:1,mapUrl:"http://192.168.0.135/osm_tiles/{z}/{x}/{y}.png",mapUrl2:"http://bigdata5/osm_tiles/{z}/{x}/{y}.png"}},mounted:function(){var t=this;this.getTask(),null!=this.task&&(this.data=this.task),this.init(),this.times=window.setInterval((function(){setTimeout(t.getTask,0)}),1e3*this.speed)},beforeDestroy:function(){clearInterval(this.times)},computed:Object(s["a"])({},Object(l["b"])(["name","task","task_id"])),watch:{task:function(t,i){t!=i&&(this.data=t)}},methods:{load:function(){var t=this;this.$nextTick((function(){var i=t.$refs.scroll;i.scrollTop=i.scrollHeight}))},init:function(){var t=this,i=c.a.map("map",{minZoom:3,maxZoom:17,center:[31.221,121.49],zoom:12,zoomControl:!1,attributionControl:!1,crs:c.a.CRS.EPSG3857});c.a.tileLayer(this.mapUrl2,{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);var a=c.a.icon({iconUrl:u.a,shadowUrl:h.a,iconSize:[25,39],iconAnchor:[12,39]});c.a.Marker.prototype.options.icon=a;c.a.icon({iconUrl:u.a,iconSize:[25,39],iconAnchor:[12,39],shadowUrl:null});function e(t){c.a.popup().setLatLng(t.latlng).setContent("经纬度: "+t.latlng.toString()).openOn(i)}i.on("click",e);var n,s=function(){var a=[];a[0]=[t.data.maxLat,t.data.maxLon],a[1]=[t.data.minLat,t.data.minLon],c.a.rectangle(a,{dashArray:5}).addTo(i),i.fitBounds(a)},o=function(){for(var a=t.data.dest,e=0;e<a.length;e++)c.a.circleMarker(a[e],{radius:10,color:"red",fillColor:"red",fillOpacity:1}).addTo(i)},l=[],r=function(){var a=[];if(0!=t.data.length){0===t.initStatus&&(s(),o(),t.initStatus=1),l=t.data.coors;for(var e=0;e<l.length;e++){var r=c.a.marker(l[e]);a.push(r)}n=c.a.layerGroup(a),i.addLayer(n),setTimeout((function(){n.clearLayers()}),.5*t.speed*1e3)}},d=this,p=setInterval((function(){console.log("data",t.data),"finish"!=t.data.status?"/realTime"==d.$route.path?r():clearInterval(p):(console.log("data",t.data),t.getResult(),clearInterval(p))}),1*this.speed*1e3)},getTask:function(){var t=this;this.listLoading=!0;var i=this.task_id;this.LogVisible=!0,0===this.taskLogStatus?(this.LodingVisible=!0,Object(o["e"])(i).then((function(i){""!=i.data.log&&null!=i.data.log&&"undefined"!=i.data.log&&0===i.data.status&&(t.count.push(i.data.log),t.load()),0!=i.data.status&&(t.LodingVisible=!1,t.taskLogStatus=1)}))):Object(o["f"])(i).then((function(a){t.$store.state.task.data=a.data,1e3===a.code?Object(o["c"])(i).then((function(i){t.LogVisible=!0;var a=i.data.log;""!=a&&null!=a&&"undefined"!=a&&(t.count.push(a),t.load())})):console.log(a.data.log)}))},getResult:function(){this.$router.push({name:"result",params:{task_id:this.task_id}})}}}),f=m,v=(a("dee3"),a("2877")),g=Object(v["a"])(f,e,n,!1,null,null,null);i["default"]=g.exports},d8ad:function(t,i,a){"use strict";var e=a("2b0e");new e["default"]},debe:function(t,i){L.AnimatedMarker=L.Marker.extend({options:{distance:200,interval:1e3,autoStart:!0,onEnd:function(){},clickable:!1},initialize:function(t,i){this.setLine(t),L.Marker.prototype.initialize.call(this,t[0],i)},_chunk:function(t){var i,a=t.length,e=[];for(i=1;i<a;i++){var n=t[i-1],s=t[i],o=n.distanceTo(s),l=this.options.distance/o,r=l*(s.lat-n.lat),c=l*(s.lng-n.lng);if(o>this.options.distance)while(o>this.options.distance)n=new L.LatLng(n.lat+r,n.lng+c),o=n.distanceTo(s),e.push(n);else e.push(n)}return e.push(t[a-1]),e},onAdd:function(t){L.Marker.prototype.onAdd.call(this,t),this.options.autoStart&&this.start()},animate:function(){var t=this,i=this._latlngs.length,a=this.options.interval;this._i<i&&this.i>0&&(a=this._latlngs[this._i-1].distanceTo(this._latlngs[this._i])/this.options.distance*this.options.interval),L.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]="all "+a+"ms linear"),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]="all "+a+"ms linear")),this.setLatLng(this._latlngs[this._i]),this._i++,this._tid=setTimeout((function(){t._i===i?t.options.onEnd.apply(t,Array.prototype.slice.call(arguments)):t.animate()}),a)},start:function(){this.animate()},stop:function(){this._tid&&clearTimeout(this._tid)},setLine:function(t){L.DomUtil.TRANSITION?this._latlngs=t:(this._latlngs=this._chunk(t),this.options.distance=10,this.options.interval=30),this._i=0}}),L.animatedMarker=function(t,i){return new L.AnimatedMarker(t,i)}},dee3:function(t,i,a){"use strict";var e=a("e994"),n=a.n(e);n.a},e994:function(t,i,a){}}]);